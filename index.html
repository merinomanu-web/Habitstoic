<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estoico Diario</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">

<style>
:root {
  --bg: #ffffff;
  --text: #000000;
  --card: rgba(255,255,255,0.85);
  --accent: #007aff;
}

body.dark {
  --bg: #000000;
  --text: #ffffff;
  --card: rgba(30,30,30,0.9);
  --accent: #0a84ff;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s, color 0.3s;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
}

h1 {
  margin: 0;
  font-size: 22px;
}

main {
  padding: 20px;
  padding-bottom: 90px;
}

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  backdrop-filter: blur(20px);
  margin-bottom: 20px;
}

#frase {
  font-size: 28px;
  font-weight: bold;
  line-height: 1.4;
  text-align: center;
  margin: 30px 0;
  min-height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.actions {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
  font-size: 28px;
}

button {
  border: none;
  background: none;
  font-size: 18px;
  cursor: pointer;
  padding: 10px;
}

.hidden {
  display: none;
}

nav {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(15px);
  display: flex;
  justify-content: space-around;
  padding: 12px 0;
  z-index: 5;
}

nav button {
  font-size: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  color: var(--text);
}

nav button span {
  font-size: 12px;
}

/* Solo "Hoy" tiene texto visible */
nav button:nth-child(1) span {
  font-weight: bold;
}

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.modal-content {
  background: white;
  color: black;
  border-radius: 16px;
  padding: 24px;
  max-width: 300px;
  text-align: center;
}

/* Timer */
#timerDisplay {
  font-size: 60px;
  font-weight: bold;
  text-align: center;
  margin: 40px 0;
}

.timer-controls {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
}

.timer-controls button {
  font-size: 20px;
  padding: 12px 24px;
  background: rgba(0,0,0,0.1);
  border-radius: 12px;
}

#timerPresets {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 20px;
}

#timerPresets button {
  font-size: 16px;
  padding: 10px 20px;
  background: rgba(0,0,0,0.05);
  border-radius: 12px;
  min-width: 80px;
}

#timerPresets button.active {
  background: var(--accent);
  color: white;
}

/* Libro */
#libroDescripcion {
  font-style: italic;
  margin: 20px 0;
  line-height: 1.5;
}

#libroLink {
  display: inline-block;
  margin-top: 15px;
  color: var(--accent);
  font-weight: bold;
  text-decoration: none;
}
</style>
</head>

<body>

<!-- LANDING -->
<div id="landing" class="modal">
  <div class="modal-content">
    <h2>Estoico Diario v1.4</h2>
    <p>
      Frases estoicas diarias.<br><br>
      Caf√©, meditaci√≥n y libros recomendados.<br><br>
      Disciplina, calma y sabidur√≠a.<br><br>
      Por <b>Kingmerino</b>
    </p>
    <button onclick="cerrarLanding()">Entrar</button>
  </div>
</div>

<header>
  <h1>Estoico Diario</h1>
  <button onclick="toggleDark()">üåô</button>
</header>

<main>

<!-- HOY -->
<section id="hoyView" class="card">
  <div id="frase"></div>
  <div class="actions">
    <button onclick="guardarFavorita()">‚ù§Ô∏è</button>
    <button onclick="compartir()">üîó</button>
    <button onclick="mostrarCafe()">‚òï</button>
  </div>
</section>

<!-- FAVORITOS -->
<section id="favoritosView" class="card hidden">
  <h3>Favoritos (m√°x. 7)</h3>
  <ul id="listaFavoritos"></ul>
  <button onclick="enviarFavoritos()">Enviar por email</button>
</section>

<!-- CAF√â -->
<section id="cafeView" class="card hidden">
  <h3>Caf√© de hoy</h3>
  <select id="cafeSelect">
    <option>Espresso</option>
    <option>Caf√© con leche</option>
    <option>Americano</option>
    <option>Capuccino</option>
    <option>Latte</option>
  </select>
  <button onclick="registrarCafe()">A√±adir</button>

  <p id="contadorCafe"></p>

  <h4>Hist√≥rico semanal</h4>
  <ul id="historialCafe"></ul>
</section>

<!-- MEDITACI√ìN -->
<section id="meditacionView" class="card hidden">
  <h3>Meditaci√≥n</h3>
  <div id="timerDisplay">10:00</div>
  
  <div class="timer-controls">
    <button id="playPauseBtn">‚ñ∂Ô∏è Iniciar</button>
    <button onclick="reiniciarTimer()">üîÑ Reiniciar</button>
  </div>

  <div id="timerPresets">
    <button onclick="setTimer(300)" class="preset-btn">5 min</button>
    <button onclick="setTimer(600)" class="preset-btn active">10 min</button>
    <button onclick="setTimer(900)" class="preset-btn">15 min</button>
    <button onclick="setTimer(1200)" class="preset-btn">20 min</button>
  </div>
</section>

<!-- LIBRO -->
<section id="libroView" class="card hidden">
  <h3>Libro Recomendado</h3>
  <h4 id="libroTitulo"></h4>
  <p id="libroAutor"></p>
  <p id="libroDescripcion"></p>
  <a id="libroLink" href="" target="_blank">Buscar en Google ‚Üó</a>
</section>

</main>

<nav>
  <button onclick="mostrarHoy()"><span>Hoy</span>üè†</button>
  <button onclick="mostrarFavoritos()">‚ù§Ô∏è</button>
  <button onclick="mostrarCafe()">‚òï</button>
  <button onclick="mostrarMeditacion()">üßò</button>
  <button onclick="mostrarLibro()">üìñ</button>
</nav>

<script>
// FRASES ESTOICAS
const frases = {
  lunes: [
    "No tienes que controlar tus pensamientos. Solo tienes que dejar de dejar que te controlen a ti.",
    "El obst√°culo es el camino.",
    "Empieza donde est√°s. Usa lo que tienes. Haz lo que puedas.",
    "La felicidad y la libertad comienzan con una clara comprensi√≥n: algunas cosas est√°n bajo nuestro control y otras no."
  ],
  martes: [
    "La calma es poder.",
    "No expliques tu filosof√≠a. Incorp√≥rala.",
    "Pierdes el d√≠a si no aprendes algo nuevo.",
    "Elige no ser da√±ado y no te sentir√°s da√±ado."
  ],
  mi√©rcoles: [
    "Haz lo correcto, aunque nadie mire.",
    "La riqueza consiste no en tener grandes posesiones, sino en tener pocas necesidades.",
    "No es lo que te ocurre, sino c√≥mo reaccionas lo que importa.",
    "Primero di a ti mismo lo que ser√°s; y luego haz lo que tienes que hacer."
  ],
  jueves: [
    "Acepta lo que es. Deja ir lo que fue. Ten fe en lo que ser√°.",
    "Puedes cometer errores, pero no eres un error.",
    "Todo lo que escuchamos es una opini√≥n, no un hecho. Todo lo que vemos es una perspectiva, no la verdad.",
    "La vida es muy corta para soportarla con mala actitud."
  ],
  viernes: [
    "La disciplina es libertad.",
    "No desperdicies el tiempo discutiendo sobre c√≥mo deber√≠a ser un buen hombre. S√© uno.",
    "Si no es necesario, no lo hagas. Si es necesario, no lo dudes.",
    "Tienes poder sobre tu mente, no sobre los eventos externos. Comprende esto y encontrar√°s fuerza."
  ],
  s√°bado: [
    "Menos es m√°s.",
    "La tranquilidad se alcanza no evitando la acci√≥n, sino actuando con virtud.",
    "No necesitas m√°s tiempo. Necesitas menos distracciones.",
    "El arte de vivir es m√°s como la lucha que como el baile."
  ],
  domingo: [
    "Descansa sin culpa.",
    "Reflexiona sobre lo que has hecho bien y lo que puedes mejorar.",
    "El hombre sabio se alegra de lo que tiene.",
    "La mejor venganza es no ser como tu enemigo."
  ]
};

const hoy = new Date();
const diaSemana = hoy.toLocaleDateString("es-ES", { weekday: "long" });
const keyFrase = "frase_" + hoy.toDateString();

let frase = localStorage.getItem(keyFrase);
if (!frase) {
  const opciones = frases[diaSemana];
  frase = opciones[Math.floor(Math.random() * opciones.length)];
  localStorage.setItem(keyFrase, frase);
}
document.getElementById("frase").innerText = frase;

// FAVORITOS
function getFavoritos() {
  return JSON.parse(localStorage.getItem("favoritos") || "[]");
}

function guardarFavorita() {
  let favs = getFavoritos();
  if (favs.length >= 7) {
    alert("M√°ximo 7 frases favoritas");
    return;
  }
  if (!favs.includes(frase)) {
    favs.push(frase);
    localStorage.setItem("favoritos", JSON.stringify(favs));
    alert("¬°Frase guardada en favoritos ‚ù§Ô∏è");
  } else {
    alert("Ya est√° en favoritos");
  }
}

function mostrarFavoritos() {
  ocultarTodo();
  document.getElementById("favoritosView").classList.remove("hidden");
  const lista = document.getElementById("listaFavoritos");
  lista.innerHTML = "";
  getFavoritos().forEach((f, i) => {
    const li = document.createElement("li");
    li.style.marginBottom = "12px";
    li.innerHTML = `${f} <button onclick="borrarFav(${i})">‚ùå</button>`;
    lista.appendChild(li);
  });
}

function borrarFav(i) {
  let favs = getFavoritos();
  favs.splice(i,1);
  localStorage.setItem("favoritos", JSON.stringify(favs));
  mostrarFavoritos();
}

function enviarFavoritos() {
  const texto = getFavoritos().join("\n\n");
  window.location.href = `mailto:?subject=Mis frases estoicas favoritas&body=${encodeURIComponent(texto)}`;
}

// CAF√â
const cafeKey = "cafe_" + hoy.toDateString();

function registrarCafe() {
  let cafes = JSON.parse(localStorage.getItem(cafeKey) || "[]");
  cafes.push(document.getElementById("cafeSelect").value);
  localStorage.setItem(cafeKey, JSON.stringify(cafes));
  if (cafes.length > 4) alert("¬°L√≠mite saludable de caf√© superado! ‚òï");
  actualizarCafe();
}

function actualizarCafe() {
  let cafes = JSON.parse(localStorage.getItem(cafeKey) || "[]");
  document.getElementById("contadorCafe").innerText = `Caf√©s hoy: ${cafes.length}`;
}

function mostrarCafe() {
  ocultarTodo();
  document.getElementById("cafeView").classList.remove("hidden");
  actualizarCafe();
  cargarHistorial();
}

function cargarHistorial() {
  const ul = document.getElementById("historialCafe");
  ul.innerHTML = "";
  for (let i = 0; i < 7; i++) {
    let d = new Date();
    d.setDate(d.getDate() - i);
    let k = "cafe_" + d.toDateString();
    let count = JSON.parse(localStorage.getItem(k) || "[]").length;
    const li = document.createElement("li");
    li.innerText = `${d.toLocaleDateString("es-ES")}: ${count} caf√©s`;
    ul.appendChild(li);
  }
}

// TIMER DE MEDITACI√ìN
let timerInterval = null;
let tiempoRestante = 600;

function actualizarDisplay() {
  const minutos = Math.floor(tiempoRestante / 60);
  const segundos = tiempoRestante % 60;
  document.getElementById("timerDisplay").innerText = 
    `${minutos.toString().padStart(2,'0')}:${segundos.toString().padStart(2,'0')}`;
}

function toggleTimer() {
  const btn = document.getElementById("playPauseBtn");
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
    btn.innerText = "‚ñ∂Ô∏è Iniciar";
  } else {
    if (tiempoRestante <= 0) tiempoRestante = 600;
    timerInterval = setInterval(() => {
      tiempoRestante--;
      actualizarDisplay();
      if (tiempoRestante <= 0) {
        clearInterval(timerInterval);
        timerInterval = null;
        document.getElementById("timerDisplay").innerText = "¬°Fin!";
        const audio = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAAA");
        audio.play();
        setTimeout(() => {
          if (confirm("¬°Meditaci√≥n completada! ¬øVolver a Hoy?")) mostrarHoy();
        }, 1000);
        btn.innerText = "‚ñ∂Ô∏è Iniciar";
      }
    }, 1000);
    btn.innerText = "‚è∏ Pausar";
  }
}

function reiniciarTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
  document.getElementById("playPauseBtn").innerText = "‚ñ∂Ô∏è Iniciar";
  actualizarDisplay();
}

function setTimer(segundos) {
  tiempoRestante = segundos;
  actualizarDisplay();
  reiniciarTimer();

  // Resaltar bot√≥n activo
  document.querySelectorAll("#timerPresets button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
}

function mostrarMeditacion() {
  ocultarTodo();
  document.getElementById("meditacionView").classList.remove("hidden");
  actualizarDisplay();
}

// LIBROS
const libros = [
  { titulo: "Meditaciones", autor: "Marco Aurelio", descripcion: "Reflexiones personales del emperador romano sobre la vida, la muerte y la virtud estoica. Un cl√°sico imprescindible." },
  { titulo: "Cartas a Lucilio", autor: "S√©neca", descripcion: "Cartas filos√≥ficas que tratan la amistad, el miedo a la muerte y la b√∫squeda de la sabidur√≠a. Perfectas para lectura diaria." },
  { titulo: "Enquiridi√≥n", autor: "Epicteto", descripcion: "Manual pr√°ctico del estoicismo: c√≥mo distinguir lo que depende de nosotros y lo que no." },
  { titulo: "Sobre la brevedad de la vida", autor: "S√©neca", descripcion: "Ensayo que nos recuerda lo valioso que es el tiempo y c√≥mo evitar desperdiciarlo." },
  { titulo: "Discursos", autor: "Epicteto", descripcion: "Lecciones profundas de un esclavo convertido en fil√≥sofo sobre libertad interior y √©tica." },
  { titulo: "De la ira", autor: "S√©neca", descripcion: "Gu√≠a pr√°ctica para dominar la ira y mantener la serenidad ante las provocaciones." }
];

function mostrarLibro() {
  ocultarTodo();
  document.getElementById("libroView").classList.remove("hidden");
  
  const libro = libros[Math.floor(Math.random() * libros.length)];
  document.getElementById("libroTitulo").innerText = libro.titulo;
  document.getElementById("libroAutor").innerText = `Autor: ${libro.autor}`;
  document.getElementById("libroDescripcion").innerText = libro.descripcion;
  
  const query = encodeURIComponent(`${libro.titulo} ${libro.autor} libro`);
  document.getElementById("libroLink").href = `https://www.google.com/search?q=${query}`;
}

// UI
function mostrarHoy() {
  ocultarTodo();
  document.getElementById("hoyView").classList.remove("hidden");
}

function ocultarTodo() {
  const views = ["hoyView", "favoritosView", "cafeView", "meditacionView", "libroView"];
  views.forEach(id => document.getElementById(id).classList.add("hidden"));
}

function compartir() {
  if (navigator.share) {
    navigator.share({ text: frase + "\n‚Äî Estoico Diario" });
  } else {
    navigator.clipboard.writeText(frase);
    alert("Frase copiada al portapapeles");
  }
}

function cerrarLanding() {
  document.getElementById("landing").style.display = "none";
}

function toggleDark() {
  document.body.classList.toggle("dark");
}

// Iniciar
mostrarHoy();
</script>

</body>
</html>
