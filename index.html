<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estoico Diario</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<style>
:root {
  --bg: #ffffff;
  --text: #000000;
  --card: rgba(255,255,255,0.85);
  --accent: #007aff;
  --glass-bg-light: rgba(255, 255, 255, 0.35);
  --glass-bg-dark: rgba(30, 30, 30, 0.45);
}

body.dark {
  --bg: #000000;
  --text: #ffffff;
  --card: rgba(30,30,30,0.9);
  --accent: #0a84ff;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s, color 0.3s;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
}

h1 {
  margin: 0;
  font-size: 22px;
}

main {
  padding: 20px;
  padding-bottom: 110px;
}

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  margin-bottom: 20px;
  transition: opacity 0.3s;
}

#frase {
  font-size: 28px;
  font-weight: bold;
  line-height: 1.4;
  text-align: center;
  margin: 30px 0;
  min-height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.actions {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
  font-size: 28px;
}

button {
  border: none;
  background: none;
  cursor: pointer;
  padding: 10px;
  border-radius: 8px;
}

button:active {
  background: rgba(0,0,0,0.1);
}

.hidden {
  display: none;
}

/* DOCK LIQUID GLASS */
nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--glass-bg-light);
  backdrop-filter: blur(30px) saturate(180%);
  -webkit-backdrop-filter: blur(30px) saturate(180%);
  border-top: 1px solid rgba(255,255,255,0.2);
  padding: 12px 0 24px 0;
  z-index: 10;
  display: flex;
  justify-content: space-around;
  align-items: center;
}

body.dark nav {
  background: var(--glass-bg-dark);
  border-top-color: rgba(255,255,255,0.1);
}

nav button {
  position: relative;
  font-size: 32px;
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  overflow: hidden;
}

nav button::before {
  content: '';
  position: absolute;
  width: 56px;
  height: 56px;
  background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, transparent 70%);
  border-radius: 50%;
  transform: scale(0);
  opacity: 0;
  transition: transform 0.4s ease, opacity 0.4s ease;
  z-index: -1;
}

body.dark nav button::before {
  background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
}

nav button::after {
  content: '';
  position: absolute;
  top: 12px;
  left: 50%;
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, rgba(255,255,255,0.7), transparent);
  border-radius: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.3s;
}

nav button:hover,
nav button:active {
  transform: translateY(-12px) scale(1.25);
}

nav button:hover::before,
nav button:active::before {
  transform: scale(2);
  opacity: 1;
}

nav button:hover::after,
nav button:active::after {
  opacity: 0.7;
}

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.modal-content {
  background: white;
  color: black;
  border-radius: 16px;
  padding: 24px;
  max-width: 300px;
  text-align: center;
}

#reflexionText, #ejercicioRespuesta {
  width: 100%;
  height: 150px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #ccc;
  font-family: inherit;
  font-size: 16px;
  margin: 15px 0;
}

.mood-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  font-size: 50px;
  margin: 20px 0;
}

.mood-history {
  text-align: center;
  font-size: 30px;
  margin: 20px 0;
  letter-spacing: 8px;
}

#timerDisplay {
  font-size: 60px;
  font-weight: bold;
  text-align: center;
  margin: 40px 0;
}

.timer-controls {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
}

.timer-controls button {
  font-size: 20px;
  padding: 12px 24px;
  background: rgba(0,0,0,0.1);
  border-radius: 12px;
}

#timerPresets {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

#timerPresets button {
  font-size: 16px;
  padding: 10px 20px;
  background: rgba(0,0,0,0.05);
  border-radius: 12px;
  min-width: 80px;
}

#timerPresets button.active {
  background: var(--accent);
  color: white;
}

#libroLink {
  display: inline-block;
  margin-top: 15px;
  color: var(--accent);
  font-weight: bold;
  text-decoration: none;
}

#exportBtn {
  margin-top: 20px;
  font-size: 16px;
  background: var(--accent);
  color: white;
  padding: 10px 20px;
  border-radius: 12px;
}
</style>
</head>

<body>

<!-- LANDING -->
<div id="landing" class="modal">
  <div class="modal-content">
    <h2>Estoico Diario v2.2</h2>
    <p>
      Frases, reflexi√≥n, meditaci√≥n, caf√©, √°nimo, libros y exportaci√≥n.<br><br>
      Timer de meditaci√≥n mejorado + dock Liquid Glass.<br><br>
      Por <b>Kingmerino</b>
    </p>
    <button onclick="cerrarLanding()">Entrar</button>
  </div>
</div>

<header>
  <h1>Estoico Diario</h1>
  <button onclick="toggleDark()">üåô</button>
</header>

<main>

<!-- PRINCIPAL -->
<section id="principalView" class="card">
  <div id="frase"></div>
  <button onclick="cambiarFrase()" style="font-size:16px; margin:20px 0; color:var(--accent);">Otra frase del d√≠a</button>

  <h3 style="text-align:center; margin:30px 0 10px;">Ejercicio estoico</h3>
  <p id="ejercicioTexto" style="font-style:italic; text-align:center;"></p>
  <textarea id="ejercicioRespuesta" placeholder="Tu respuesta o reflexi√≥n..."></textarea>
  <button onclick="guardarEjercicio()" style="font-size:16px; color:var(--accent);">Guardar ejercicio</button>

  <div class="actions">
    <button onclick="guardarFavorita()">‚ù§Ô∏è</button>
    <button onclick="compartir()">üîó</button>
    <button onclick="mostrarCafe()">‚òï</button>
  </div>
</section>

<!-- FAVORITOS, CAF√â, REFLEXI√ìN, √ÅNIMO, LIBRO, EXPORTAR (igual que antes) -->
<section id="favoritosView" class="card hidden">...</section>
<section id="cafeView" class="card hidden">...</section>
<section id="reflexionView" class="card hidden">...</section>
<section id="animoView" class="card hidden">...</section>
<section id="libroView" class="card hidden">...</section>
<section id="exportView" class="card hidden">...</section>

<!-- MEDITACI√ìN (MEJORADA) -->
<section id="meditacionView" class="card hidden">
  <h3>Meditaci√≥n</h3>
  <div id="timerDisplay">10:00</div>
  
  <div class="timer-controls">
    <button id="playPauseBtn">‚ñ∂Ô∏è Iniciar</button>
    <button onclick="reiniciarTimer()">üîÑ Reiniciar</button>
  </div>

  <div id="timerPresets">
    <button onclick="setTimerAndUpdate(300)">5 min</button>
    <button onclick="setTimerAndUpdate(600)" class="active">10 min</button>
    <button onclick="setTimerAndUpdate(900)">15 min</button>
    <button onclick="setTimerAndUpdate(1200)">20 min</button>
  </div>
</section>

</main>

<nav>
  <button onclick="mostrarPrincipal()">üè†</button>
  <button onclick="mostrarFavoritos()">‚ù§Ô∏è</button>
  <button onclick="mostrarCafe()">‚òï</button>
  <button onclick="mostrarMeditacion()">üßò</button>
  <button onclick="mostrarReflexion()">üìù</button>
  <button onclick="mostrarAnimo()">üòä</button>
  <button onclick="mostrarLibro()">üìñ</button>
  <button onclick="mostrarExport()">üíæ</button>
</nav>

<script>
// VARIABLES GLOBALES DEL TIMER
let timerInterval = null;
let tiempoRestante = 600; // 10 minutos por defecto

// FUNCI√ìN PARA ACTUALIZAR EL DISPLAY
function actualizarDisplay() {
  const minutos = Math.floor(tiempoRestante / 60).toString().padStart(2, '0');
  const segundos = (tiempoRestante % 60).toString().padStart(2, '0');
  document.getElementById("timerDisplay").innerText = `${minutos}:${segundos}`;
}

// NUEVA FUNCI√ìN: Cambiar tiempo y actualizar todo correctamente
function setTimerAndUpdate(segundos) {
  tiempoRestante = segundos;
  actualizarDisplay();
  reiniciarTimer(); // Detiene si estaba en marcha y resetea bot√≥n

  // Resaltar bot√≥n activo
  document.querySelectorAll("#timerPresets button").forEach(btn => btn.classList.remove("active"));
  event.target.classList.add("active");
}

// INICIAR / PAUSAR
function toggleTimer() {
  const btn = document.getElementById("playPauseBtn");

  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
    btn.innerText = "‚ñ∂Ô∏è Iniciar";
  } else {
    if (tiempoRestante <= 0) {
      tiempoRestante = 600; // Valor por defecto si llega a 0
      actualizarDisplay();
    }
    timerInterval = setInterval(() => {
      tiempoRestante--;
      actualizarDisplay();
      if (tiempoRestante <= 0) {
        clearInterval(timerInterval);
        timerInterval = null;
        document.getElementById("timerDisplay").innerText = "¬°Fin!";
        const audio = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAAA");
        audio.play();
        setTimeout(() => {
          if (confirm("¬°Meditaci√≥n completada! ¬øVolver a inicio?")) mostrarPrincipal();
        }, 1000);
        btn.innerText = "‚ñ∂Ô∏è Iniciar";
      }
    }, 1000);
    btn.innerText = "‚è∏ Pausar";
  }
}

// REINICIAR
function reiniciarTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
  document.getElementById("playPauseBtn").innerText = "‚ñ∂Ô∏è Iniciar";
  actualizarDisplay();
}

// MOSTRAR MEDITACI√ìN (actualiza display al entrar)
function mostrarMeditacion() {
  ocultarTodo();
  document.getElementById("meditacionView").classList.remove("hidden");
  actualizarDisplay();
}

// RESTO DEL C√ìDIGO (frases, favoritos, caf√©, etc.) igual que en v2.1
// (Todo lo dem√°s permanece id√©ntico al c√≥digo anterior)

// ... [Todo el resto del script de la versi√≥n v2.1 aqu√≠] ...

// Inicializaci√≥n
actualizarDisplay(); // Asegura que el display est√© correcto al cargar
mostrarPrincipal();
if (localStorage.getItem("darkMode") === "true") document.body.classList.add("dark");
</script>

</body>
</html>
