<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estoico Diario</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<style>
:root {
  --bg: #ffffff;
  --text: #000000;
  --card: rgba(255,255,255,0.85);
  --accent: #007aff;
  --glass-bg-light: rgba(255, 255, 255, 0.35);
  --glass-bg-dark: rgba(30, 30, 30, 0.45);
}

body.dark {
  --bg: #000000;
  --text: #ffffff;
  --card: rgba(30,30,30,0.9);
  --accent: #0a84ff;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s, color 0.3s;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
}

h1 {
  margin: 0;
  font-size: 22px;
}

main {
  padding: 20px;
  padding-bottom: 110px;
}

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  margin-bottom: 20px;
}

#frase {
  font-size: 28px;
  font-weight: bold;
  line-height: 1.4;
  text-align: center;
  margin: 30px 0;
  min-height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.actions {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
  font-size: 28px;
}

button {
  border: none;
  background: none;
  cursor: pointer;
  padding: 10px;
  border-radius: 8px;
}

button:active {
  background: rgba(0,0,0,0.1);
}

.hidden {
  display: none;
}

/* DOCK LIQUID GLASS */
nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--glass-bg-light);
  backdrop-filter: blur(30px) saturate(180%);
  -webkit-backdrop-filter: blur(30px) saturate(180%);
  border-top: 1px solid rgba(255,255,255,0.2);
  padding: 12px 0 24px 0;
  z-index: 10;
  display: flex;
  justify-content: space-around;
  align-items: center;
}

body.dark nav {
  background: var(--glass-bg-dark);
  border-top-color: rgba(255,255,255,0.1);
}

nav button {
  position: relative;
  font-size: 32px;
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  overflow: hidden;
}

nav button::before {
  content: '';
  position: absolute;
  width: 56px;
  height: 56px;
  background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, transparent 70%);
  border-radius: 50%;
  transform: scale(0);
  opacity: 0;
  transition: transform 0.4s ease, opacity 0.4s ease;
  z-index: -1;
}

body.dark nav button::before {
  background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
}

nav button::after {
  content: '';
  position: absolute;
  top: 12px;
  left: 50%;
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, rgba(255,255,255,0.7), transparent);
  border-radius: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.3s;
}

nav button:hover,
nav button:active {
  transform: translateY(-12px) scale(1.25);
}

nav button:hover::before,
nav button:active::before {
  transform: scale(2);
  opacity: 1;
}

nav button:hover::after,
nav button:active::after {
  opacity: 0.7;
}

/* LANDING PAGE */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.modal-content {
  background: var(--card);
  color: var(--text);
  border-radius: 20px;
  padding: 32px;
  max-width: 320px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

.modal-content button {
  margin-top: 24px;
  background: var(--accent);
  color: white;
  padding: 14px 32px;
  border-radius: 14px;
  font-size: 18px;
  font-weight: bold;
}

/* Otros estilos */
#reflexionText, #ejercicioRespuesta {
  width: 100%;
  height: 150px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #ccc;
  font-family: inherit;
  font-size: 16px;
  margin: 15px 0;
}

.mood-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  font-size: 50px;
  margin: 20px 0;
}

.mood-history {
  text-align: center;
  font-size: 30px;
  margin: 20px 0;
  letter-spacing: 8px;
}

#timerDisplay {
  font-size: 60px;
  font-weight: bold;
  text-align: center;
  margin: 40px 0;
}

.timer-controls {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin: 30px 0;
}

.timer-controls button {
  font-size: 20px;
  padding: 14px 32px;
  background: rgba(0,0,0,0.1);
  border-radius: 16px;
}

#libroLink {
  display: inline-block;
  margin-top: 15px;
  color: var(--accent);
  font-weight: bold;
  text-decoration: none;
}

#exportBtn {
  margin-top: 20px;
  font-size: 16px;
  background: var(--accent);
  color: white;
  padding: 10px 20px;
  border-radius: 12px;
}
</style>
</head>

<body>

<!-- LANDING PAGE -->
<div id="landing" class="modal">
  <div class="modal-content">
    <h2>Estoico Diario v2.4</h2>
    <p>
      Frases diarias, reflexi√≥n, meditaci√≥n (10 min fija), caf√©, √°nimo, libros y exportaci√≥n.<br><br>
      Vive con disciplina, calma y virtud.<br><br>
      Desarrollada por <b>Kingmerino</b>
    </p>
    <button onclick="cerrarLanding()">Entrar</button>
  </div>
</div>

<header>
  <h1>Estoico Diario</h1>
  <button onclick="toggleDark()">üåô</button>
</header>

<main>

<!-- PRINCIPAL -->
<section id="principalView" class="card">
  <div id="frase"></div>
  <button onclick="cambiarFrase()" style="font-size:16px; margin:20px 0; color:var(--accent);">Otra frase del d√≠a</button>

  <h3 style="text-align:center; margin:30px 0 10px;">Ejercicio estoico</h3>
  <p id="ejercicioTexto" style="font-style:italic; text-align:center;"></p>
  <textarea id="ejercicioRespuesta" placeholder="Tu respuesta o reflexi√≥n..."></textarea>
  <button onclick="guardarEjercicio()" style="font-size:16px; color:var(--accent);">Guardar ejercicio</button>

  <div class="actions">
    <button onclick="guardarFavorita()">‚ù§Ô∏è</button>
    <button onclick="compartir()">üîó</button>
    <button onclick="mostrarCafe()">‚òï</button>
  </div>
</section>

<!-- FAVORITOS -->
<section id="favoritosView" class="card hidden">
  <h3>Favoritos (m√°x. 7)</h3>
  <ul id="listaFavoritos"></ul>
  <button onclick="enviarFavoritos()">Enviar por email</button>
</section>

<!-- CAF√â -->
<section id="cafeView" class="card hidden">
  <h3>Caf√© de hoy</h3>
  <select id="cafeSelect">
    <option>Espresso</option>
    <option>Caf√© con leche</option>
    <option>Americano</option>
    <option>Capuccino</option>
    <option>Latte</option>
  </select>
  <button onclick="registrarCafe()">A√±adir</button>
  <p id="contadorCafe"></p>
  <h4>Hist√≥rico semanal</h4>
  <ul id="historialCafe"></ul>
</section>

<!-- MEDITACI√ìN (SIMPLIFICADA: 10 MIN FIJOS) -->
<section id="meditacionView" class="card hidden">
  <h3>Meditaci√≥n</h3>
  <div id="timerDisplay">10:00</div>
  
  <div class="timer-controls">
    <button id="playPauseBtn">‚ñ∂Ô∏è Iniciar</button>
    <button onclick="reiniciarTimer()">üîÑ Reiniciar</button>
  </div>

  <p style="text-align:center; font-style:italic; margin-top:40px;">
    Meditaci√≥n guiada de 10 minutos.<br>
    Respira profundamente y enf√≥cate en el presente.
  </p>
</section>

<!-- REFLEXI√ìN -->
<section id="reflexionView" class="card hidden">
  <h3>Reflexi√≥n de hoy</h3>
  <p style="font-style:italic; text-align:center;">‚Äú<span id="fraseReflexion"></span>‚Äù</p>
  <textarea id="reflexionText" placeholder="¬øQu√© significa esta frase para ti hoy? ¬øC√≥mo la aplicar√°s?"></textarea>
  <button onclick="guardarReflexion()" style="font-size:16px; color:var(--accent);">Guardar reflexi√≥n</button>
  <h4 style="margin-top:30px;">Hist√≥rico (√∫ltimos 30 d√≠as)</h4>
  <ul id="historialReflexion"></ul>
</section>

<!-- √ÅNIMO -->
<section id="animoView" class="card hidden">
  <h3>¬øC√≥mo te sientes hoy?</h3>
  <div class="mood-buttons">
    <button onclick="registrarAnimo('üò¢')">üò¢</button>
    <button onclick="registrarAnimo('üòê')">üòê</button>
    <button onclick="registrarAnimo('üòä')">üòä</button>
    <button onclick="registrarAnimo('üòÉ')">üòÉ</button>
  </div>
  <h4>√öltimos 7 d√≠as</h4>
  <div class="mood-history" id="moodHistory"></div>
</section>

<!-- LIBRO -->
<section id="libroView" class="card hidden">
  <h3>Libro Recomendado</h3>
  <h4 id="libroTitulo"></h4>
  <p id="libroAutor"></p>
  <p id="libroDescripcion"></p>
  <a id="libroLink" href="" target="_blank">Buscar en Google ‚Üó</a>
</section>

<!-- EXPORTAR -->
<section id="exportView" class="card hidden">
  <h3>Exportar datos</h3>
  <p>Descarga todos tus datos como archivo de texto.</p>
  <button id="exportBtn" onclick="exportarDatos()">Descargar datos</button>
</section>

</main>

<nav>
  <button onclick="mostrarPrincipal()">üè†</button>
  <button onclick="mostrarFavoritos()">‚ù§Ô∏è</button>
  <button onclick="mostrarCafe()">‚òï</button>
  <button onclick="mostrarMeditacion()">üßò</button>
  <button onclick="mostrarReflexion()">üìù</button>
  <button onclick="mostrarAnimo()">üòä</button>
  <button onclick="mostrarLibro()">üìñ</button>
  <button onclick="mostrarExport()">üíæ</button>
</nav>

<script>
// CERRAR LANDING
function cerrarLanding() {
  document.getElementById("landing").style.display = "none";
}

// FRASES ESTOICAS
const frases = {
  lunes: [
    "El obst√°culo es el camino.",
    "Empieza donde est√°s. Usa lo que tienes. Haz lo que puedas.",
    "La felicidad de tu vida depende de la calidad de tus pensamientos.",
    "No tienes que controlar tus pensamientos. Solo dejar de dejar que te controlen.",
    "Controla lo que depende de ti, acepta lo que no."
  ],
  martes: [
    "La calma es poder.",
    "No expliques tu filosof√≠a. Incorp√≥rala.",
    "Pierdes el d√≠a si no aprendes algo nuevo.",
    "Elige no ser da√±ado y no te sentir√°s da√±ado.",
    "Muy poco es necesario para hacer una vida feliz."
  ],
  mi√©rcoles: [
    "Haz lo correcto, aunque nadie mire.",
    "La riqueza consiste en tener pocas necesidades.",
    "No es lo que te ocurre, sino c√≥mo reaccionas lo que importa.",
    "Primero di a ti mismo lo que ser√°s; y luego haz lo que tienes que hacer.",
    "El hombre sabio se alegra de lo que tiene."
  ],
  jueves: [
    "Acepta lo que es. Deja ir lo que fue. Ten fe en lo que ser√°.",
    "Puedes cometer errores, pero no eres un error.",
    "Todo lo que escuchamos es una opini√≥n, no un hecho.",
    "La vida es muy corta para soportarla con mala actitud.",
    "Tienes poder sobre tu mente, no sobre los eventos externos."
  ],
  viernes: [
    "La disciplina es libertad.",
    "No desperdicies tiempo discutiendo c√≥mo deber√≠a ser un buen hombre. S√© uno.",
    "Si no es necesario, no lo hagas. Si es necesario, no lo dudes.",
    "La mejor venganza es no ser como tu enemigo.",
    "Comienza a vivir de una vez."
  ],
  s√°bado: [
    "Menos es m√°s.",
    "La tranquilidad se alcanza actuando con virtud.",
    "No necesitas m√°s tiempo. Necesitas menos distracciones.",
    "El arte de vivir es m√°s como la lucha que como el baile.",
    "Descansa, pero sin culpa."
  ],
  domingo: [
    "Descansa sin culpa.",
    "Reflexiona sobre lo que has hecho bien y lo que puedes mejorar.",
    "El hombre sabio se alegra de lo que tiene.",
    "La mejor venganza es una vida bien vivida.",
    "Agradece lo que tienes. Vivir√°s m√°s feliz."
  ]
};

const hoy = new Date();
const fechaStr = hoy.toDateString();
const diaSemana = hoy.toLocaleDateString("es-ES", { weekday: "long" });
const keyFrase = "frase_" + fechaStr;
const keyFraseOriginal = "fraseOriginal_" + fechaStr;

let frase = localStorage.getItem(keyFrase) || localStorage.getItem(keyFraseOriginal);
if (!frase) {
  const opciones = frases[diaSemana];
  frase = opciones[Math.floor(Math.random() * opciones.length)];
  localStorage.setItem(keyFraseOriginal, frase);
  localStorage.setItem(keyFrase, frase);
}
document.getElementById("frase").innerText = frase;

function cambiarFrase() {
  const opciones = frases[diaSemana];
  let nueva;
  do {
    nueva = opciones[Math.floor(Math.random() * opciones.length)];
  } while (nueva === frase);
  frase = nueva;
  document.getElementById("frase").innerText = frase;
}

// EJERCICIO ESTOICO
const ejercicios = [
  "Dichotom√≠a del control: Escribe 3 cosas que hoy dependen de ti y 3 que no.",
  "Visualizaci√≥n negativa: Imagina que pierdes algo valioso hoy. ¬øC√≥mo reaccionar√≠as con virtud?",
  "Gratitud: Escribe 3 cosas por las que est√°s agradecido hoy.",
  "Memento mori: Si este fuera tu √∫ltimo d√≠a, ¬øqu√© har√≠as diferente?"
];

let ejercicioActual = localStorage.getItem("ejercicio_" + fechaStr);
if (!ejercicioActual) {
  ejercicioActual = ejercicios[Math.floor(Math.random() * ejercicios.length)];
  localStorage.setItem("ejercicio_" + fechaStr, ejercicioActual);
}
document.getElementById("ejercicioTexto").innerText = ejercicioActual;

const respuestaEjercicioGuardada = localStorage.getItem("ejercicioRespuesta_" + fechaStr);
if (respuestaEjercicioGuardada) {
  document.getElementById("ejercicioRespuesta").value = respuestaEjercicioGuardada;
}

function guardarEjercicio() {
  const respuesta = document.getElementById("ejercicioRespuesta").value.trim();
  if (respuesta) {
    localStorage.setItem("ejercicioRespuesta_" + fechaStr, respuesta);
    alert("Ejercicio guardado");
  }
}

// FAVORITOS
function getFavoritos() {
  return JSON.parse(localStorage.getItem("favoritos") || "[]");
}

function guardarFavorita() {
  let favs = getFavoritos();
  if (favs.length >= 7) {
    alert("M√°ximo 7 frases favoritas");
    return;
  }
  if (!favs.includes(frase)) {
    favs.push(frase);
    localStorage.setItem("favoritos", JSON.stringify(favs));
    alert("¬°Guardada en favoritos ‚ù§Ô∏è");
  } else {
    alert("Ya est√° en favoritos");
  }
}

function mostrarFavoritos() {
  ocultarTodo();
  document.getElementById("favoritosView").classList.remove("hidden");
  const lista = document.getElementById("listaFavoritos");
  lista.innerHTML = "";
  getFavoritos().forEach((f, i) => {
    const li = document.createElement("li");
    li.style.marginBottom = "12px";
    li.innerHTML = `${f} <button onclick="borrarFav(${i})">‚ùå</button>`;
    lista.appendChild(li);
  });
}

function borrarFav(i) {
  let favs = getFavoritos();
  favs.splice(i, 1);
  localStorage.setItem("favoritos", JSON.stringify(favs));
  mostrarFavoritos();
}

function enviarFavoritos() {
  const texto = getFavoritos().join("\n\n");
  window.location.href = `mailto:?subject=Mis frases estoicas favoritas&body=${encodeURIComponent(texto)}`;
}

// CAF√â
const cafeKey = "cafe_" + fechaStr;

function registrarCafe() {
  let cafes = JSON.parse(localStorage.getItem(cafeKey) || "[]");
  cafes.push(document.getElementById("cafeSelect").value);
  localStorage.setItem(cafeKey, JSON.stringify(cafes));
  if (cafes.length > 4) alert("¬°L√≠mite saludable superado! ‚òï");
  actualizarCafe();
}

function actualizarCafe() {
  let cafes = JSON.parse(localStorage.getItem(cafeKey) || "[]");
  document.getElementById("contadorCafe").innerText = `Caf√©s hoy: ${cafes.length}`;
}

function mostrarCafe() {
  ocultarTodo();
  document.getElementById("cafeView").classList.remove("hidden");
  actualizarCafe();
  cargarHistorialCafe();
}

function cargarHistorialCafe() {
  const ul = document.getElementById("historialCafe");
  ul.innerHTML = "";
  for (let i = 0; i < 7; i++) {
    let d = new Date();
    d.setDate(d.getDate() - i);
    let k = "cafe_" + d.toDateString();
    let count = JSON.parse(localStorage.getItem(k) || "[]").length;
    const li = document.createElement("li");
    li.innerText = `${d.toLocaleDateString("es-ES")}: ${count} caf√©s`;
    ul.appendChild(li);
  }
}

// TIMER DE MEDITACI√ìN SIMPLIFICADO (10 MIN FIJOS)
let timerInterval = null;
const TIEMPO_DEFAULT = 600; // 10 minutos en segundos
let tiempoRestante = TIEMPO_DEFAULT;

function actualizarDisplay() {
  const minutos = Math.floor(tiempoRestante / 60).toString().padStart(2, '0');
  const segundos = (tiempoRestante % 60).toString().padStart(2, '0');
  document.getElementById("timerDisplay").innerText = `${minutos}:${segundos}`;
}

function toggleTimer() {
  const btn = document.getElementById("playPauseBtn");
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
    btn.innerText = "‚ñ∂Ô∏è Iniciar";
  } else {
    if (tiempoRestante <= 0) {
      tiempoRestante = TIEMPO_DEFAULT;
      actualizarDisplay();
    }
    timerInterval = setInterval(() => {
      tiempoRestante--;
      actualizarDisplay();
      if (tiempoRestante <= 0) {
        clearInterval(timerInterval);
        timerInterval = null;
        document.getElementById("timerDisplay").innerText = "¬°Fin!";
        const audio = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAAA");
        audio.play();
        setTimeout(() => {
          if (confirm("¬°Meditaci√≥n completada! ¬øVolver a inicio?")) mostrarPrincipal();
        }, 1000);
        btn.innerText = "‚ñ∂Ô∏è Iniciar";
      }
    }, 1000);
    btn.innerText = "‚è∏ Pausar";
  }
}

function reiniciarTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
  tiempoRestante = TIEMPO_DEFAULT;
  document.getElementById("playPauseBtn").innerText = "‚ñ∂Ô∏è Iniciar";
  actualizarDisplay();
}

function mostrarMeditacion() {
  ocultarTodo();
  document.getElementById("meditacionView").classList.remove("hidden");
  reiniciarTimer(); // Siempre empieza en 10:00 al entrar
}

// REFLEXI√ìN, √ÅNIMO, LIBRO, EXPORTAR (igual que antes)
function mostrarReflexion() {
  ocultarTodo();
  document.getElementById("reflexionView").classList.remove("hidden");
  document.getElementById("fraseReflexion").innerText = localStorage.getItem(keyFraseOriginal) || frase;
  document.getElementById("reflexionText").value = localStorage.getItem("reflexion_" + fechaStr) || "";

  const ul = document.getElementById("historialReflexion");
  ul.innerHTML = "";
  for (let i = 1; i <= 30; i++) {
    let d = new Date();
    d.setDate(d.getDate() - i);
    let k = "reflexion_" + d.toDateString();
    let texto = localStorage.getItem(k);
    if (texto) {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${d.toLocaleDateString("es-ES")}</strong><br>${texto.substring(0,100)}...`;
      ul.appendChild(li);
    }
  }
}

function guardarReflexion() {
  const texto = document.getElementById("reflexionText").value.trim();
  if (texto) {
    localStorage.setItem("reflexion_" + fechaStr, texto);
    alert("Reflexi√≥n guardada");
  }
}

function registrarAnimo(emoji) {
  localStorage.setItem("animo_" + fechaStr, emoji);
  alert("√Ånimo registrado " + emoji);
  mostrarHistoriaAnimo();
}

function mostrarAnimo() {
  ocultarTodo();
  document.getElementById("animoView").classList.remove("hidden");
  mostrarHistoriaAnimo();
}

function mostrarHistoriaAnimo() {
  const div = document.getElementById("moodHistory");
  div.innerHTML = "";
  for (let i = 6; i >= 0; i--) {
    let d = new Date();
    d.setDate(d.getDate() - i);
    let emoji = localStorage.getItem("animo_" + d.toDateString()) || "‚ûñ";
    div.innerHTML += emoji + " ";
  }
}

const libros = [
  { titulo: "Meditaciones", autor: "Marco Aurelio", descripcion: "Reflexiones personales del emperador romano sobre la vida, la muerte y la virtud estoica." },
  { titulo: "Cartas a Lucilio", autor: "S√©neca", descripcion: "Cartas filos√≥ficas sobre amistad, miedo a la muerte y sabidur√≠a pr√°ctica." },
  { titulo: "Enquiridi√≥n", autor: "Epicteto", descripcion: "Manual conciso para distinguir lo que depende de nosotros y lo que no." },
  { titulo: "Sobre la brevedad de la vida", autor: "S√©neca", descripcion: "Ensayo sobre c√≥mo no desperdiciar el tiempo que tenemos." },
  { titulo: "Discursos", autor: "Epicteto", descripcion: "Lecciones profundas sobre libertad interior y √©tica." },
  { titulo: "De la ira", autor: "S√©neca", descripcion: "Gu√≠a pr√°ctica para controlar la ira y mantener la calma." }
];

function mostrarLibro() {
  ocultarTodo();
  document.getElementById("libroView").classList.remove("hidden");
  const libro = libros[Math.floor(Math.random() * libros.length)];
  document.getElementById("libroTitulo").innerText = libro.titulo;
  document.getElementById("libroAutor").innerText = `Autor: ${libro.autor}`;
  document.getElementById("libroDescripcion").innerText = libro.descripcion;
  const query = encodeURIComponent(`${libro.titulo} ${libro.autor} libro`);
  document.getElementById("libroLink").href = `https://www.google.com/search?q=${query}`;
}

function mostrarExport() {
  ocultarTodo();
  document.getElementById("exportView").classList.remove("hidden");
}

function exportarDatos() {
  let texto = "=== ESTOICO DIARIO - TUS DATOS ===\n\n";
  texto += "Favoritos:\n" + getFavoritos().join("\n") + "\n\n";
  texto += "Reflexiones (√∫ltimos 30 d√≠as):\n";
  for (let i = 1; i <= 30; i++) {
    let d = new Date();
    d.setDate(d.getDate() - i);
    let r = localStorage.getItem("reflexion_" + d.toDateString());
    if (r) texto += `${d.toLocaleDateString("es-ES")}: ${r}\n\n`;
  }
  texto += "Caf√© (√∫ltimos 7 d√≠as):\n";
  for (let i = 0; i < 7; i++) {
    let d = new Date();
    d.setDate(d.getDate() - i);
    let count = JSON.parse(localStorage.getItem("cafe_" + d.toDateString()) || "[]").length;
    texto += `${d.toLocaleDateString("es-ES")}: ${count} caf√©s\n`;
  }
  texto += "\n√Ånimo (√∫ltimos 7 d√≠as):\n";
  for (let i = 6; i >= 0; i--) {
    let d = new Date();
    d.setDate(d.getDate() - i);
    let emoji = localStorage.getItem("animo_" + d.toDateString()) || "‚ûñ";
    texto += `${d.toLocaleDateString("es-ES")}: ${emoji}\n`;
  }

  const blob = new Blob([texto], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "estoico_diario_datos.txt";
  a.click();
}

// NAVEGACI√ìN
function mostrarPrincipal() {
  ocultarTodo();
  document.getElementById("principalView").classList.remove("hidden");
}

function ocultarTodo() {
  const views = ["principalView", "favoritosView", "cafeView", "meditacionView", "reflexionView", "animoView", "libroView", "exportView"];
  views.forEach(id => document.getElementById(id).classList.add("hidden"));
}

function compartir() {
  if (navigator.share) {
    navigator.share({ text: frase + "\n‚Äî Estoico Diario" });
  } else {
    navigator.clipboard.writeText(frase);
    alert("Frase copiada al portapapeles");
  }
}

// MODO OSCURO
function toggleDark() {
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode", document.body.classList.contains("dark"));
}

if (localStorage.getItem("darkMode") === "true") {
  document.body.classList.add("dark");
}

// INICIO
mostrarPrincipal();
actualizarDisplay();
</script>

</body>
</html>
